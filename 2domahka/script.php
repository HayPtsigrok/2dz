<?php
$messages = []; // Инициализация пустого массива для хранения сообщений.
$filePath = 'data.txt'; // Указание пути к файлу, в который будут сохраняться сообщения.

if ($_SERVER["REQUEST_METHOD"] == "POST") { // Проверка, был ли отправлен POST-запрос.
    $name = htmlspecialchars(trim($_POST['name'])); // Получение и очистка имени пользователя от лишних пробелов и специальных символов.
    $email = htmlspecialchars(trim($_POST['email'])); // Получение и очистка email от лишних пробелов и специальных символов.
    $message = htmlspecialchars(trim($_POST['message'])); // Получение и очистка сообщения от лишних пробелов и специальных символов.

    if (!empty($name) && !empty($email) && !empty($message)) { // Проверка, заполнены ли все поля (имя, email, сообщение).
        $dateTime = date('Y-m-d H:i:s'); // Получение текущей даты и времени в формате 'ГГГГ-ММ-ДД ЧЧ:ММ:СС'.
        $message = nl2br($message); // Преобразование символов новой строки в HTML-теги <br> для корректного отображения в браузере.
        $entry = "$name|$email|$dateTime|$message\n"; // Формирование строки записи с разделителями (|) для сохранения в файл.
        file_put_contents($filePath, $entry, FILE_APPEND | LOCK_EX); // Запись строки в файл, добавляя ее в конец файла и блокируя его для других процессов.
    }
}

if (file_exists($filePath)) { // Проверка, существует ли файл с сообщениями.
    $messages = array_reverse(file($filePath, FILE_IGNORE_NEW_LINES)); // Чтение содержимого файла в массив, игнорируя символы новой строки, и переворот массива (чтобы последние сообщения были первыми).
}
}
